{"id":"CP-egb","title":"Sandboxed JS evaluator with document subscriptions and output","description":"Run a JS file in a sandbox with the ability to:\n- Declare dependencies on other commonplace documents\n- Subscribe to commits on those dependencies\n- Create a read-only output document\n- Listen for commands on the output document's path\n- Emit events as that document\n\nThe JS file acts as a reactive transform: inputs → computation → output document.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-28T22:49:01.433243-08:00","updated_at":"2025-12-30T01:45:22.787863201Z","dependencies":[{"issue_id":"CP-egb","depends_on_id":"CP-nno","type":"blocks","created_at":"2025-12-28T22:50:33.552787-08:00","created_by":"daemon"}]}
{"id":"CP-8t3","title":"Move HTTP interface to separate binary with MQTT connection","description":"Extract the HTTP interface into a new binary that connects to the document store over MQTT instead of direct access.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T21:56:46.493852588Z","updated_at":"2025-12-29T08:45:22.041612098Z","closed_at":"2025-12-29T01:52:01.289555636Z","created_by":"jes","dependencies":[{"issue_id":"CP-8t3","depends_on_id":"CP-08v","type":"blocks","created_at":"2025-12-28T21:57:24.845534402Z","created_by":"daemon"}]}
{"id":"CP-cxj","title":"Sync tool skips files with unknown extensions","description":"Ensure sync tool skips files with extensions it doesn't understand rather than failing or corrupting them.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T17:54:27.688193893Z","updated_at":"2025-12-30T18:09:02.091283573Z","closed_at":"2025-12-30T18:09:02.091283573Z","created_by":"jes"}
{"id":"CP-9u1","title":"Sync client uses derived IDs instead of UUIDs from schema","description":"After CP-4f7 (deprecate derived IDs), the reconciler generates UUIDs for file entries. But the sync client still constructs derived IDs like 'fs-root:path/to/file.txt' when syncing file contents, instead of reading the node_id UUIDs from the updated schema.\n\nSteps to reproduce:\n1. Start server with --fs-root\n2. Run sync with --directory pointing to a folder with files\n3. Sync pushes schema, reconciler creates documents with UUIDs\n4. Sync tries to push file content using derived ID\n5. 'Identifier not found, waiting for reconciler' loops forever\n\nExpected: Sync should re-fetch the schema after push to get the UUID node_ids, then use those for file content syncing.\n\nBlocking bartleby integration testing.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-31T16:54:04.192088145Z","updated_at":"2025-12-31T17:17:14.235135137Z","closed_at":"2025-12-31T17:17:14.235135137Z","created_by":"jes"}
{"id":"CP-o1h","title":"Fix: Merge commits should include both parent_cid and current HEAD as parents","description":"When parent_cid differs from HEAD in replace endpoint, the new commit only includes parent_cid as its parent. This drops the current HEAD from the commit graph. On history replay, the concurrent edits from HEAD are lost.\n\nFix: When parent_differs is true, the commit should have BOTH parent_cid AND current_head as parents.\n\nFound by local codex review on PR #37.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-30T08:14:26.210722759Z","updated_at":"2025-12-30T08:24:36.109315944Z","closed_at":"2025-12-30T08:24:36.109315944Z","created_by":"jes"}
{"id":"CP-0j4","title":"Fix P1: Respect explicit node_id from server schema (PR #4)","description":"From PR #4 Codex review: When the server's FsSchema uses DocEntry.node_id for stable IDs, this should be respected instead of deriving IDs.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-26T23:24:23.072384-08:00","updated_at":"2025-12-26T23:43:14.374964-08:00","closed_at":"2025-12-26T23:43:14.374964-08:00"}
{"id":"CP-li3","title":"Deprecate wiring diagram concept","description":"The wiring diagram concept should be deprecated and removed from the codebase.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T21:56:44.059396274Z","updated_at":"2025-12-29T08:56:46.462777465Z","closed_at":"2025-12-29T00:50:28.541758-08:00","created_by":"jes"}
{"id":"CP-lr9","title":"Sync race condition causes output file overwrites","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-31T20:09:30.137946956Z","updated_at":"2025-12-31T21:51:40.994526815Z","closed_at":"2025-12-31T21:51:40.994526815Z","created_by":"jes"}
{"id":"CP-6pd","title":"Use cwd to run processes in sandbox directory instead of symlinks/env vars","description":"When conductor/orchestrator spawns processes for directory-attached work, set the working directory (cwd) to the sandbox/workspace directory instead of relying on symlinks or environment variables like BARTLEBY_WORKING_DIR. This allows programs that use relative paths to naturally see the sandbox contents without any special configuration. Simpler and more transparent than the symlink approach.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-31T17:04:16.788917689Z","updated_at":"2025-12-31T19:55:32.624440087Z","closed_at":"2025-12-31T19:55:32.624440087Z","created_by":"jes"}
{"id":"CP-rs3","title":"File copy in sync directory triggers document fork","description":"When a new file appears in a synced directory with content that exactly matches another file already synced by the same process, automatically fork the original document rather than creating an unrelated new document. Detection: pure content hash matching against all currently synced files.","notes":"PR #47 created. Codex review requested. P2 limitation filed as CP-og0 for binary files.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-30T17:58:58.555594612Z","updated_at":"2025-12-30T20:22:08.593492297Z","closed_at":"2025-12-30T20:22:08.593492297Z","created_by":"jes"}
{"id":"CP-eoy","title":"commonplace-link: support linking anywhere within a checked out file tree","description":"Currently commonplace-link only works for files in the same directory. For use cases like linking bartleby's workspace files to text-to-telegram files, we need cross-directory linking within a synced tree.\n\nProposed behavior:\n- commonplace-link source target (where both are in the same synced workspace tree)\n- Updates both files' schemas to share the same UUID\n- When either file is edited, both sync to the same document\n\nUse case: bartleby/prompts.txt linked to telegram/content.txt so telegram messages become bartleby prompts, and bartleby/output.txt linked to telegram/input.txt so bartleby responses go to telegram.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-31T23:23:03.804284034Z","updated_at":"2026-01-01T01:58:24.737984163Z","closed_at":"2026-01-01T01:58:24.737984163Z","created_by":"jes"}
{"id":"CP-2u5","title":"Replace endpoint doesn't work for JSON documents","description":"The /docs/{id}/replace endpoint uses character-level diffing via Y.Text, but JSON documents use Y.Map internally. When calling replace on a JSON document (like fs-root), the content is not updated. Workaround: Use the /edit endpoint with create_yjs_json_update instead.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-01T00:27:16.371497913Z","updated_at":"2026-01-01T02:05:49.98180474Z","closed_at":"2026-01-01T02:05:49.98180474Z","created_by":"jes"}
{"id":"CP-80u","title":"Fix P2: Skip wiring when an identical edge already exists (PR #8)","description":"From PR #8 Codex review: The router creates wires based on managed_wires, but if a wiring already exists from an external source (e.g., /nodes/:from/wire/:to), this code will still call wire_* and create a second subscription. Consider checking existing registry wirings before adding.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T23:24:33.186937-08:00","updated_at":"2025-12-27T00:35:45.522329-08:00","closed_at":"2025-12-27T00:35:45.522329-08:00"}
{"id":"CP-4a0","title":"Refactor discovery.rs: Extract process state machine","description":"orchestrator/discovery.rs is 542 lines. Extract `ManagedDiscoveredProcess` state machine and lifecycle handling into separate module, keeping only config parsing and discovery logic in discovery.rs.","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-30T00:34:51.339252-08:00","updated_at":"2025-12-30T16:55:35.033866881Z","closed_at":"2025-12-30T16:55:35.033866881Z"}
{"id":"CP-08v","title":"Add MQTT support","description":"Add MQTT protocol support to commonplace. Spec will be supplied (TBD).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T21:56:45.192898672Z","updated_at":"2025-12-29T00:39:05.428000759Z","closed_at":"2025-12-29T00:39:05.428000759Z","created_by":"jes"}
{"id":"CP-ksf","title":"CLI tool for firing commands to commonplace paths","description":"A command-line tool that sends commands to a specified commonplace document path. Allows scripting and manual interaction with commonplace documents via their red port (events/commands).","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-28T22:49:01.268771-08:00","updated_at":"2025-12-29T23:50:06.348786945Z","closed_at":"2025-12-29T23:50:06.348786945Z"}
{"id":"CP-sz8","title":"Refactor document.rs: Extract ContentType to dedicated module","description":"document.rs has ContentType enum with MIME conversion, default content generation, and detection logic. Extract to `src/content_type.rs` to be shared between document.rs and sync/ modules (which has partial duplication).","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-30T00:34:51.455397-08:00","updated_at":"2025-12-30T16:42:58.50460762Z","closed_at":"2025-12-30T16:42:58.50460762Z"}
{"id":"CP-bno","title":"POST /docs should accept initial content in request body","description":"Currently POST /docs creates an empty document. The request body is not used as initial content.\n\nEnhancement: Allow POST /docs to accept content in the body, either:\n1. JSON body for JSON documents\n2. Text body for text documents\n\nThis would simplify workflows where you want to create a document with specific content.","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-01T00:15:49.814509595Z","updated_at":"2026-01-01T00:15:49.814509595Z","created_by":"jes"}
{"id":"CP-5i1","title":"HTML + WebSocket server process","description":"Server process that serves static HTML viewer and provides WebSocket connections for live document streaming. Powers the live HTML viewer (CP-6oj).","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-30T18:00:20.018424314Z","updated_at":"2025-12-30T18:00:20.018424314Z","created_by":"jes"}
{"id":"CP-320","title":"Sync push loses node_ids when updating fs-root schema on server","description":"The sync correctly preserves node_ids when scanning locally (CP-8ou), but when it pushes the schema to the server, the node_ids become null.\n\nLocal .commonplace.json has correct shared UUIDs:\n- bartleby/prompts.txt: 0b250a22-3163-49df-8634-534585865cdd\n- telegram/content.txt: 0b250a22-3163-49df-8634-534585865cdd\n\nBut server's fs-root document has null for both.\n\nThis breaks file linking because the reconciler sees null and generates new random UUIDs.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-01T00:11:19.958347431Z","updated_at":"2026-01-01T02:06:52.691341058Z","closed_at":"2026-01-01T02:06:52.691341058Z","created_by":"jes"}
{"id":"CP-lav","title":"Python client: y_py YDoc not thread-safe with paho-mqtt callbacks","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-30T00:30:34.203735202Z","updated_at":"2025-12-30T01:17:06.747552054Z","closed_at":"2025-12-30T01:17:06.747552054Z","created_by":"jes"}
{"id":"CP-cgi","title":"Fix P1: Use JSON replay when pushing Y.Map schema updates (PR #6)","description":"From PR #6 Codex review: The change switches the initial fs-root schema write to a Y.Map update but needs to use JSON replay instead for proper handling.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-26T23:24:21.54461-08:00","updated_at":"2025-12-26T23:39:41.921295-08:00","closed_at":"2025-12-26T23:39:41.921295-08:00"}
{"id":"CP-dgu","title":"Sync tool: persist state locally for offline change detection","description":"The sync tool currently has no local state persistence. On restart, it fetches HEAD from the server and may overwrite local changes made while sync was stopped.\n\n## Current Behavior\n- SyncState is purely in-memory (last_written_cid, last_written_content)\n- On startup, fetches server HEAD and writes to local file\n- --initial-sync flag offers limited control (skip/local/server) but no conflict detection\n- Local changes made while offline could be silently lost\n\n## Proposed Solution\nPersist sync state to a local file (e.g., .commonplace-sync.json or alongside each synced file):\n- Last synced CID\n- Last synced content hash\n- Timestamp of last sync\n\nOn restart:\n1. Load persisted state\n2. Compare local file hash to persisted hash → detect local modifications\n3. Fetch server HEAD → detect server modifications  \n4. If both modified: conflict (prompt user or use strategy flag)\n5. If only local modified: push to server\n6. If only server modified: pull to local\n7. If neither modified: resume normal sync\n\n## Files to modify\n- src/bin/sync.rs - Add state persistence and conflict detection\n- Possibly src/sync/ modules for shared types","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-30T05:08:27.003489287Z","updated_at":"2025-12-30T06:26:58.408628459Z","closed_at":"2025-12-30T06:26:58.408628459Z","created_by":"jes"}
{"id":"CP-1ba","title":"Fix P1: Use text fs-root or send JSON-compatible updates (PR #4)","description":"From PR #4 Codex review: The fs-root node is created with content_type application/json but the updates being sent may not be JSON-compatible.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-26T23:24:23.464711-08:00","updated_at":"2025-12-27T00:14:06.868523-08:00","closed_at":"2025-12-27T00:14:06.868523-08:00","dependencies":[{"issue_id":"CP-1ba","depends_on_id":"CP-qmk","type":"blocks","created_at":"2025-12-26T23:41:34.266588-08:00","created_by":"daemon"}]}
{"id":"CP-g0c","title":"Sync corrupts .commonplace.json schema - overwrites to {} or {version:1}","description":"When running commonplace-sync with --directory and --node, the local .commonplace.json schema gets corrupted. It starts with a proper schema (version, root, entries with files) but gets repeatedly overwritten to just {} or {\"version\":1}. The fs-root document on the server ends up with content: {} instead of the full schema. This breaks directory sync completely.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-01T01:49:36.833268107Z","updated_at":"2026-01-01T01:54:58.343768111Z","closed_at":"2026-01-01T01:54:58.343768111Z","created_by":"jes"}
{"id":"CP-ckt","title":"Fix P1: URL-encode derived node IDs for nested files (PR #4)","description":"From PR #4 Codex review: When syncing directories, file.relative_path will include / characters which need to be URL-encoded for node IDs.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-26T23:24:22.662002-08:00","updated_at":"2025-12-26T23:42:34.654703-08:00","closed_at":"2025-12-26T23:42:34.654703-08:00"}
{"id":"CP-nno","title":"External process MQTT client as first-class citizen","description":"Allow a separate Unix process to connect to MQTT and perform all the same actions as the JS sandbox evaluator:\n- Subscribe to document commits\n- Create/own output documents\n- Receive commands on owned document paths\n- Emit events as owned documents\n\nThis makes external processes (any language) first-class participants in the commonplace reactive graph, using MQTT as the protocol.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-28T22:49:01.52436-08:00","updated_at":"2025-12-30T01:26:42.019335953Z","closed_at":"2025-12-30T01:26:42.019335953Z"}
{"id":"CP-q3m","title":"CLI tool with relative path support in synced directories","description":"The command-line command-issuing tool should work inside a synced directory such that you can use relative paths to send commands to the relevant document.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-30T17:48:46.353930244Z","updated_at":"2025-12-30T18:24:55.356003983Z","closed_at":"2025-12-30T18:24:55.356003983Z","created_by":"jes"}
{"id":"CP-oji","title":"Handle rename events so new paths get sync tasks","description":"notify reports renames as `Modify(Name)` events; the current mapping treats all `is_modify()` as `DirEvent::Modified`. The modified handler only re-pushes schema and never starts new per-file sync tasks or removes old ones, so a rename leaves the new file untracked and the old path's tasks running until restart.\n\nConsider handling rename explicitly (or treating `Modify(Name)` as delete+create).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T17:03:59.632881-08:00","updated_at":"2025-12-26T17:49:57.531409-08:00","closed_at":"2025-12-26T17:49:57.531409-08:00"}
{"id":"CP-jnf","title":"Support JSON files as Yjs map/array types in directory sync","description":"Summary: Allow synced JSON files to be stored as Yjs map/array types (not plain text) so JSON structure is preserved in CRDT.\n\nFiles to modify:\n- src/document.rs (content type handling / default doc type)\n- src/diff.rs (JSON diff generation if needed)\n- src/bin/sync.rs (JSON file handling, initial sync)\n- src/sync/content_type.rs (content type mapping, potentially new metadata)\n- docs/FILESYSTEM.md (clarify JSON type behavior)\n- docs/WIRING_DIAGRAM_FILES.md (if wiring files need special handling)\n\nImplementation steps:\n1. Identify how JSON documents are represented in yrs (map/array) vs text and how current commits are applied.\n2. Decide on encoding for JSON files in sync (map vs array based on top-level JSON).\n3. Update sync upload/replace logic to send JSON updates rather than text edits for JSON files.\n4. Ensure server-side content retrieval returns serialized JSON for map/array docs.\n5. Add tests/fixtures for JSON map/array round-trips through sync.\n\nExample:\n- Before: file data.json stored as plain text in Yjs text.\n- After: data.json stored as Yjs map or array (based on top-level JSON), serialized to JSON text on read/write.\n","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-28T13:28:50.035996-08:00","updated_at":"2025-12-28T14:00:59.660408-08:00","closed_at":"2025-12-28T14:00:59.660408-08:00"}
{"id":"CP-pta","title":"Rename /nodes API to /docs throughout codebase","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T08:37:04.362222409Z","updated_at":"2025-12-29T09:40:55.11574492Z","closed_at":"2025-12-29T09:40:55.11574492Z","created_by":"jes"}
{"id":"CP-4e9","title":"Sync protocol infinite loop: commit:null parsed as request","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-30T00:30:17.030876486Z","updated_at":"2025-12-30T01:17:06.619813304Z","closed_at":"2025-12-30T01:17:06.619813304Z","created_by":"jes"}
{"id":"CP-cv9","title":"Validate at_commit CID belongs to requested document (P2 from codex review)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T06:23:26.603794724Z","updated_at":"2025-12-30T23:01:36.990246638Z","closed_at":"2025-12-30T23:01:36.990246638Z","created_by":"jes"}
{"id":"CP-7m0","title":"Flat directory JSON with subdirectory documents","description":"Directory JSON should only contain one level of files. Subdirectories need to be their own separate JSON documents. This enables partial checkouts of large directory trees.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-30T17:47:47.262049538Z","updated_at":"2025-12-30T21:56:23.60592734Z","closed_at":"2025-12-30T21:56:23.60592734Z","created_by":"jes"}
{"id":"CP-ylp","title":"Enforce mandatory file extensions in filesystem sync","description":"Update commonplace filesystem so that file extensions are mandatory. Only .json, .txt, .xml, .xhtml, and .bin files can be synced, and they must correspond to their Yjs implementations.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T21:56:43.205364505Z","updated_at":"2025-12-28T23:14:28.396705982Z","closed_at":"2025-12-28T23:14:28.396705982Z","created_by":"jes"}
{"id":"CP-ajb","title":"Add integration tests for MQTT path resolution","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T08:03:39.396454509Z","updated_at":"2025-12-30T23:17:27.562485622Z","closed_at":"2025-12-30T23:17:27.562485622Z","created_by":"jes"}
{"id":"CP-hm9","title":"MCP server: Keep MQTT event loop alive until publish is delivered","status":"open","priority":3,"issue_type":"bug","created_at":"2025-12-30T02:22:36.905947547Z","updated_at":"2025-12-30T02:22:43.66815698Z","created_by":"jes"}
{"id":"CP-5we","title":"Beads integration with bidirectional sync","description":"Sync beads JSONL into commonplace as documents. Edits made via commonplace should publish back to beads, enabling bidirectional issue tracking integration.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-30T17:56:53.320326707Z","updated_at":"2025-12-30T17:56:53.320326707Z","created_by":"jes","dependencies":[{"issue_id":"CP-5we","depends_on_id":"CP-oi3","type":"blocks","created_at":"2025-12-30T18:43:29.742508518Z","created_by":"daemon"}]}
{"id":"CP-8ci","title":"Sync sandbox mode with temp directory isolation","description":"Upgrade sync subprocess mode to sync sandbox: uses a temp directory, checks out a synced directory or subdirectory, runs the child process in there, and cleans up after itself when the child exits.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-30T17:50:05.321115052Z","updated_at":"2025-12-30T21:33:57.619323351Z","closed_at":"2025-12-30T21:33:57.619323351Z","created_by":"jes","dependencies":[{"issue_id":"CP-8ci","depends_on_id":"CP-cxj","type":"blocks","created_at":"2025-12-30T18:02:57.400462144Z","created_by":"daemon"},{"issue_id":"CP-8ci","depends_on_id":"CP-w2v","type":"blocks","created_at":"2025-12-30T18:02:57.424433327Z","created_by":"daemon"}]}
{"id":"CP-96p","title":"create_yjs_json_update produces malformed nested JSON","description":"When pushing JSON to a Y.Map document, the create_yjs_json_update function puts the entire root object as a string value instead of properly nesting the Y.Map structure. Example: {\"version\":1,\"root\":\"\\n  \\\"version\\\": 1,\\n  \\\"root\\\": {\\n...\"} - The root field contains escaped JSON string instead of an object.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-01T00:28:29.314098124Z","updated_at":"2026-01-01T02:06:51.668159906Z","closed_at":"2026-01-01T02:06:51.668159906Z","created_by":"jes"}
{"id":"CP-ce1","title":"Implement .processes.json discovery for conductor","description":"Conductor discovers .processes.json files in the document tree and automatically launches/manages declared processes. Enables user-defined processes to attach to file paths without central configuration.\n\nSee: docs/plans/2025-12-30-processes-json-design.md\n\nTasks:\n- Parse .processes.json format (command, owns, cwd)\n- Watch document tree for .processes.json changes\n- Launch processes with COMMONPLACE_PATH and COMMONPLACE_MQTT env vars\n- Restart with exponential backoff on failure\n- Handle conflicts (warn if two processes claim same path)\n- Update counter example to use this convention","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-30T04:17:59.60264365Z","updated_at":"2025-12-30T04:56:47.832163772Z","closed_at":"2025-12-30T04:56:47.832163772Z","created_by":"jes"}
{"id":"CP-zkk","title":"Implement CRDT merge for offline changes in sync tool","description":"Follow-up from CP-dgu. When the sync tool detects offline local changes on restart (via state file hash comparison), it should:\n\n1. Fetch historical Yjs state at last_synced_cid using ?at_commit endpoint\n2. Compute diff from historical state to current local content\n3. Create Yjs update from diff\n4. Push update to server (CRDT automatically merges with any server changes)\n5. Pull merged result and update local file\n\nThe infrastructure is ready:\n- State file tracks last_synced_cid and file hashes (CP-dgu, PR #36)\n- ?at_commit endpoint returns Yjs state at any historical commit\n- Offline change detection logs 'Detected offline local changes' on startup\n\nJust needs the merge logic implementation in run_file_mode after detecting changes.","notes":"Reviewed code: offline CRDT merge is already implemented in run_file_mode (lines 322-381). Detects offline changes, pushes via replace endpoint with last_synced_cid as parent for proper CRDT merge.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T06:27:49.553275883Z","updated_at":"2025-12-30T18:42:48.412284179Z","closed_at":"2025-12-30T18:42:48.412284179Z","created_by":"jes"}
{"id":"CP-3ve","title":"Identify and refactor large files into smaller modules","description":"Audit the codebase for files that have grown too large and could benefit from being split into smaller, more focused modules. Look for files with multiple distinct responsibilities that could be separated.","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-29T13:47:42.244104-08:00","updated_at":"2025-12-30T03:24:24.008280981Z","closed_at":"2025-12-30T03:24:24.008280981Z"}
{"id":"CP-5af","title":"Telegram messages ↔ file integration","description":"Bidirectional sync between Telegram messages and commonplace documents:\n- Receive Telegram messages as document updates or events\n- Send document content/edits to Telegram chats\n- Subscribe to specific chats/channels\n- Bot or user account authentication\n\nEnables messaging-as-document patterns and chat automation.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-28T23:53:18.825068-08:00","updated_at":"2025-12-30T01:45:22.840556932Z","dependencies":[{"issue_id":"CP-5af","depends_on_id":"CP-nno","type":"blocks","created_at":"2025-12-28T23:53:18.82599-08:00","created_by":"daemon"}]}
{"id":"CP-yq8","title":"Refactor sync.rs: Extract SSE subscription loop","description":"Extract SSE subscription handling from sync.rs into `src/sync/sse_client.rs`. This manages server event subscriptions, reconnection, and incoming edit processing.","status":"closed","priority":1,"issue_type":"chore","created_at":"2025-12-30T00:34:51.027152-08:00","updated_at":"2025-12-30T15:51:57.815913081Z","closed_at":"2025-12-30T15:51:57.815913081Z","dependencies":[{"issue_id":"CP-yq8","depends_on_id":"CP-jwf","type":"blocks","created_at":"2025-12-30T00:36:37.050903-08:00","created_by":"daemon"}]}
{"id":"CP-7gx","title":"Sync --use-paths should work without --node when server has fs-root","description":"Currently sync client with --use-paths still requires --node. When using path-based endpoints (/files/*path), the sync should be able to work without specifying a node ID since paths are resolved on the server.\n\nWorkaround: Query /fs-root endpoint (CP-81o) to get the node ID.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-31T23:59:59.108226549Z","updated_at":"2025-12-31T23:59:59.108226549Z","created_by":"jes"}
{"id":"CP-zif","title":"Commonplace link tool for shared document references","description":"A symlink/hardlink-like tool (possible names: synclink, commonlink) that works in a checked-out sync directory to create another file pointing to the same document UUID. Implementation likely involves editing the directory JSON to add another entry referencing the same document.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-30T17:52:42.458856392Z","updated_at":"2025-12-30T22:44:51.153396044Z","closed_at":"2025-12-30T22:44:51.153396044Z","created_by":"jes"}
{"id":"CP-c7h","title":"Podman for untrusted sandbox","description":"Use Podman containers for sandboxed execution of untrusted code. Provides stronger isolation than temp directory sandbox for running arbitrary user-provided commands.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-30T19:39:21.869408178Z","updated_at":"2025-12-30T19:39:21.869408178Z","created_by":"jes"}
{"id":"CP-0fy","title":"Sync tool should checkout directory JSON definition as .json file","description":"The sync tool (commonplace-sync) should write the JSON definition of a directory as a file named `.json` in that directory. This would allow users to see and potentially edit the directory's metadata/structure definition alongside the directory contents.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-28T14:57:56.428338-08:00","updated_at":"2025-12-29T22:37:26.417918062Z","closed_at":"2025-12-29T22:37:26.417918062Z"}
{"id":"CP-w2v","title":"Directory JSON as hidden file inside checkout","description":"Synced directory JSON should be a hidden file inside the checked out directory, not outside it. Sync tool should handle this intelligently (avoid syncing the hidden file itself, proper conflict handling, etc.).","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-30T17:54:00.14442659Z","updated_at":"2025-12-30T18:10:05.226276237Z","closed_at":"2025-12-30T18:10:05.226276237Z","created_by":"jes"}
{"id":"CP-4xd","title":"Directory-attached process management for orchestrator","description":"Similar to the existing file-attached process mechanism, add support for declaring that a process is running 'in a directory' that the orchestrator manages. This will be the primary paradigm for the sync-sandbox tool.\n\nUnlike file-attached processes which are tied to a specific document, directory-attached processes operate on a directory scope and can interact with multiple files within that directory tree.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-31T06:47:45.584747427Z","updated_at":"2025-12-31T16:27:44.602430837Z","closed_at":"2025-12-31T16:27:44.602430837Z","created_by":"jes"}
{"id":"CP-qyj","title":"TypeScript support for sandboxed evaluator","description":"Extend the JS sandbox evaluator to support TypeScript. This could mean:\n- Transpiling TS → JS before evaluation\n- Supporting .ts file extensions in sandbox\n- Type definitions for the sandbox API (dependencies, output documents, events)\n\nThis makes the sandbox more ergonomic for larger/complex reactive transforms.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-28T23:53:18.488271-08:00","updated_at":"2025-12-28T23:53:18.488271-08:00","dependencies":[{"issue_id":"CP-qyj","depends_on_id":"CP-egb","type":"blocks","created_at":"2025-12-28T23:53:18.489746-08:00","created_by":"daemon"}]}
{"id":"CP-56w","title":"Refactor api.rs: Separate path-based vs ID-based routing","description":"api.rs has mixed concerns for /docs/{id} and /files/{path} routing. Extract path-based API (`/files/*`) into separate module to clarify the two API styles.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-30T00:34:51.228276-08:00","updated_at":"2025-12-30T16:31:46.635504385Z","closed_at":"2025-12-30T16:31:46.635504385Z","dependencies":[{"issue_id":"CP-56w","depends_on_id":"CP-ejh","type":"blocks","created_at":"2025-12-30T00:36:37.094635-08:00","created_by":"daemon"}]}
{"id":"CP-o2h","title":"Evaluate whether NodeRegistry is still needed after HTTP/store split","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T00:52:45.145726221Z","updated_at":"2025-12-29T04:12:26.221158382Z","closed_at":"2025-12-29T04:12:26.221158382Z","created_by":"jes","dependencies":[{"issue_id":"CP-o2h","depends_on_id":"CP-8t3","type":"blocks","created_at":"2025-12-29T00:52:52.493729194Z","created_by":"daemon"}]}
{"id":"CP-z7t","title":"MCP server using commonplace JSON file for tool/resource definitions","description":"An MCP server that reads a specified commonplace JSON document and exposes its contents as MCP tools, resources, and prompts. The JSON document defines the MCP schema, and the server dynamically serves those definitions to MCP clients.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-28T22:49:01.180475-08:00","updated_at":"2025-12-30T01:44:22.367660722Z"}
{"id":"CP-c1b","title":"Fix P1: Start sync tasks for newly created local files (PR #4)","description":"From PR #4 Codex review: In directory mode, create/modify events only trigger a schema update but don't start sync tasks for the new files.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-26T23:24:21.87906-08:00","updated_at":"2025-12-26T23:43:55.607923-08:00","closed_at":"2025-12-26T23:43:55.607923-08:00"}
{"id":"CP-qmk","title":"Fix P1: Preserve schema deletions when pushing updates (PR #7)","description":"From PR #7 Codex review: When pushing schema updates, deletions are not being preserved. The code always posts an edit built by create_yjs_map_update but this may not handle entry deletions properly. Need to investigate and fix.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-26T23:24:21.270524-08:00","updated_at":"2025-12-27T00:14:06.786038-08:00","closed_at":"2025-12-27T00:14:06.786038-08:00"}
{"id":"CP-6oj","title":"Live HTML viewer with websocket updates","description":"Browser-based viewer that connects via websocket to display commonplace documents in real-time. XHTML documents render as HTML, JSON and XML documents display formatted source. Updates stream live as documents change.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-30T17:59:51.301579711Z","updated_at":"2025-12-30T17:59:51.301579711Z","created_by":"jes","dependencies":[{"issue_id":"CP-6oj","depends_on_id":"CP-5i1","type":"blocks","created_at":"2025-12-30T18:00:25.637694596Z","created_by":"daemon"}]}
{"id":"CP-a85","title":"Filetree to XHTML renderer","description":"Render a filetree (directory structure) as XHTML output.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-30T17:54:39.878136696Z","updated_at":"2025-12-30T17:54:39.878136696Z","created_by":"jes"}
{"id":"CP-eyi","title":"Cron-style recurring scheduled events","description":"Fire events on a recurring schedule (like crontab). Use cases:\n- Periodic document refresh triggers\n- Scheduled backup/export jobs\n- Regular polling of external sources\n- Time-based workflow triggers\n\nCould be defined as a special node type or as a configuration on documents.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-28T23:53:18.565001-08:00","updated_at":"2025-12-30T01:44:47.450426047Z"}
{"id":"CP-dnc","title":"Make sync robust when a process uses atomic-writes to edit a file","description":"The file watcher in src/sync/watcher.rs uses is_modify() to detect file changes. While this should catch rename events (since Modify(Name(To)) is a Modify variant), there are potential edge cases:\n\n1. Directory watcher (lines 179-209) explicitly handles rename modes - robust\n2. File watcher (lines 70-86) only checks is_modify() - less explicit\n\nInvestigate:\n- What happens if editor does delete+create instead of atomic rename?\n- Platform-specific inotify behavior (path vs inode watching)\n- Does watcher need to re-attach after file replacement?\n\nConsider:\n- Add explicit rename handling to file_watcher_task\n- Add integration tests with atomic write patterns\n- Test with vim, emacs, VSCode atomic saves","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T22:52:32.17908978Z","updated_at":"2025-12-31T23:04:38.726997837Z","closed_at":"2025-12-31T23:04:38.726997837Z","created_by":"jes"}
{"id":"CP-y9l","title":"tmux ↔ file integration","description":"Bidirectional sync between tmux pane content and commonplace documents:\n- Capture tmux pane content to a document (scrollback, current view)\n- Send content from a document to a tmux pane (sendkeys)\n- Subscribe to pane output as a stream\n- Control tmux sessions/windows/panes via document commands\n\nEnables terminal-as-document patterns and terminal automation.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-28T23:53:18.734354-08:00","updated_at":"2025-12-30T01:45:22.817292165Z","dependencies":[{"issue_id":"CP-y9l","depends_on_id":"CP-nno","type":"blocks","created_at":"2025-12-28T23:53:18.735182-08:00","created_by":"daemon"}]}
{"id":"CP-51t","title":"Verify diff module returns correct summary struct for replace endpoint","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T08:03:48.888669529Z","updated_at":"2025-12-29T09:01:47.131481523Z","closed_at":"2025-12-29T09:01:47.131481523Z","created_by":"jes"}
{"id":"CP-lzb","title":"Fix P1: Start sync tasks for files created from server schema (PR #4)","description":"From PR #4 Codex review: When a new path appears in the server schema, the handler doesn't start sync tasks for the new files.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-26T23:24:22.281537-08:00","updated_at":"2025-12-26T23:43:55.692683-08:00","closed_at":"2025-12-26T23:43:55.692683-08:00"}
{"id":"CP-pgx","title":"MCP server for firing commands to commonplace paths","description":"An MCP server that exposes commonplace document paths as callable tools. MCP clients can invoke commands on commonplace documents, bridging LLM tool-use with the commonplace reactive document system.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-28T22:49:01.349217-08:00","updated_at":"2025-12-30T01:43:40.761417202Z","closed_at":"2025-12-30T01:43:40.761417202Z","dependencies":[{"issue_id":"CP-pgx","depends_on_id":"CP-ksf","type":"related","created_at":"2025-12-28T22:50:33.586139-08:00","created_by":"daemon"}]}
{"id":"CP-se0","title":"One-time scheduled events (at-style)","description":"Schedule events to fire at a specific point in the future. Unlike cron (recurring), these are one-shot:\n- Reminders\n- Delayed actions\n- Future-dated triggers\n- Timeout/deadline events\n\nCould share infrastructure with cron scheduling but with single-fire semantics.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-28T23:53:18.644504-08:00","updated_at":"2025-12-30T01:44:47.476156216Z","dependencies":[{"issue_id":"CP-se0","depends_on_id":"CP-eyi","type":"related","created_at":"2025-12-28T23:53:29.351623-08:00","created_by":"daemon"}]}
{"id":"CP-2pr","title":"Break sync.rs into smaller modules","description":"src/bin/sync.rs is 2734 lines and too large for a single module. It should be refactored into smaller, focused modules for better maintainability and readability.\n\nSuggested breakdown:\n- Core sync state machine\n- File system operations  \n- MQTT message handling\n- Conflict resolution logic\n- Document path resolution","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-31T07:03:46.71615207Z","updated_at":"2025-12-31T07:03:46.71615207Z","created_by":"jes"}
{"id":"CP-81o","title":"Server should expose fs-root document ID at /fs-root endpoint","description":"When server is started with --fs-root, there's no way for clients to discover the fs-root document ID. Add GET /fs-root endpoint that returns the document ID.\n\nThis would simplify the sync workflow - clients could auto-discover the fs-root instead of needing to pass --node.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-31T23:59:51.564657714Z","updated_at":"2025-12-31T23:59:51.564657714Z","created_by":"jes"}
{"id":"CP-8fz","title":"Fix server replay to use node's content type for JSON documents","description":"P1 from PR #6 review: The server's /nodes/:id/head and replace endpoints replay with ContentType::Text, but Y.Map commits need ContentType::Json. When replaying Y.Map commits with Text type, replay.rs returns \"Text root not found\" causing 500 errors.\n\nFix: Update src/api.rs (around lines 460-464) to use the node's actual content type when replaying commits.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-26T18:13:33.205983-08:00","updated_at":"2025-12-26T18:22:55.113026-08:00","closed_at":"2025-12-26T18:22:55.113026-08:00"}
{"id":"CP-okn","title":"New orchestrator binary for process management","description":"Create a new orchestrator binary which invokes the document store and (once they exist) other processes like HTTP interface and sandboxed evaluator.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T21:56:47.418639497Z","updated_at":"2025-12-29T08:45:22.029787664Z","closed_at":"2025-12-29T03:12:03.336139764Z","created_by":"jes","dependencies":[{"issue_id":"CP-okn","depends_on_id":"CP-8t3","type":"blocks","created_at":"2025-12-28T21:57:25.7353176Z","created_by":"daemon"}]}
{"id":"CP-ejh","title":"Refactor api.rs: Extract document handlers to service layer","description":"api.rs is 918 lines. Extract document CRUD operations into a service layer module (`src/services/document.rs`), separating business logic from HTTP handler concerns.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-30T00:34:51.124071-08:00","updated_at":"2025-12-30T16:17:43.597788755Z","closed_at":"2025-12-30T16:17:43.597788755Z"}
{"id":"CP-8ou","title":"Directory sync doesn't preserve node_ids from existing .commonplace.json","description":"When running commonplace-sync in directory mode, scan_directory() always generates fresh Entry structs with node_id: None. It doesn't read the existing .commonplace.json to preserve manually-set node_ids.\n\nThis blocks the ability to link files across directories by manually editing node_ids in the schema - the sync overwrites them on every scan.\n\nExpected behavior: scan_directory should merge with existing .commonplace.json, preserving node_ids for files that still exist.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-31T23:35:43.380888682Z","updated_at":"2025-12-31T23:50:25.998188768Z","closed_at":"2025-12-31T23:50:25.998188768Z","created_by":"jes"}
{"id":"CP-og0","title":"Fork detection: binary file hash mismatch","description":"In CP-rs3 implementation, fork detection for binary files won't work correctly because:\n- Initial sync stores hash of base64-encoded content (via scan_directory_with_contents)\n- New file detection hashes raw bytes before encoding\n\nThis means identical binary files won't be detected as copies. Text files work correctly.\n\nFix: Hash raw file bytes in both cases, before any base64 encoding.","status":"closed","priority":3,"issue_type":"bug","created_at":"2025-12-30T20:07:20.775344004Z","updated_at":"2025-12-31T23:04:39.527009741Z","closed_at":"2025-12-31T23:04:39.527009741Z","created_by":"jes"}
{"id":"CP-3ky","title":"Implement Router Documents (docs/ROUTER.md)","description":"Implement the router document feature as specified in docs/ROUTER.md:\n\n- Add `--router \u003cnode-id\u003e` CLI flag (repeatable)\n- Router documents are JSON with `version`, `nodes`, and `edges` \n- Server subscribes to router document blue port for changes\n- Apply/diff wiring based on router document content\n- Emit `router.error` events on red port for errors\n- Handle node creation hints from `nodes` section\n- Track router-created wires separately from other wires","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-26T18:29:01.089173-08:00","updated_at":"2025-12-26T23:22:36.003263-08:00","closed_at":"2025-12-26T23:22:36.003263-08:00"}
{"id":"CP-jwf","title":"Refactor sync.rs: Extract SyncState into separate module","description":"sync.rs is 2,407 lines - the largest file in the codebase. Extract `SyncState` struct and its associated methods (echo detection, write tracking, hash tracking) into `src/sync/state.rs`.","status":"closed","priority":1,"issue_type":"chore","created_at":"2025-12-30T00:34:50.838547-08:00","updated_at":"2025-12-30T08:54:16.77161781Z","closed_at":"2025-12-30T08:54:16.77161781Z"}
{"id":"CP-7n2","title":"Refactor sync.rs: Extract file watcher logic","description":"Extract file watcher setup and event handling from sync.rs into dedicated module `src/sync/watcher.rs`. This handles notify events, debouncing, and change detection.","status":"closed","priority":1,"issue_type":"chore","created_at":"2025-12-30T00:34:50.932224-08:00","updated_at":"2025-12-30T15:26:25.522185703Z","closed_at":"2025-12-30T15:26:25.522185703Z","dependencies":[{"issue_id":"CP-7n2","depends_on_id":"CP-jwf","type":"blocks","created_at":"2025-12-30T00:36:37.008385-08:00","created_by":"daemon"}]}
{"id":"CP-adm","title":"Macaroons for MQTT-layer authorization","description":"Implement macaroon-based authorization enforced at the MQTT layer. Macaroons provide:\n- Delegatable, attenuatable credentials\n- Fine-grained path-based permissions\n- Caveat-based restrictions (time, scope, etc.)\n\nEnforcement at MQTT means all clients (JS sandbox, external processes, CLI, MCP servers) go through the same auth layer.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-28T22:49:01.628965-08:00","updated_at":"2025-12-30T01:44:34.551124057Z"}
{"id":"CP-uj2","title":"Represent directory trees as Yjs JSON (Y.Map) instead of text JSON","description":"Currently, the fs-root document uses TEXT content type with JSON stored as a text string. This was a workaround because the edit system (diff.rs, replay.rs) uses TEXT-based Yjs updates (Y.Text), but DocumentNode for JSON type uses Y.Map internally.\n\nThe proper solution would be to use native Yjs JSON structure (Y.Map) for directory schemas, which would enable:\n- Proper CRDT merging of concurrent schema changes\n- More efficient updates (only changed entries, not full document replacement)\n- Better conflict resolution for concurrent file additions/deletions","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-26T17:04:59.967959-08:00","updated_at":"2025-12-26T18:01:42.374357-08:00","closed_at":"2025-12-26T18:01:42.374357-08:00"}
{"id":"CP-bth","title":"Sync tool should respect environment variables as set by orchestrator","description":"The sync client (commonplace-sync) should read and respect environment variables that are set by the orchestrator process. This allows the orchestrator to configure sync behavior (server URL, node ID, etc.) through environment variables rather than requiring all configuration to be passed as CLI arguments.\n\nNote: This issue was recovered from commit ee6f395 after being accidentally deleted during a beads sync conflict.","notes":"Reviewed: sync tool already respects COMMONPLACE_SERVER, COMMONPLACE_NODE, COMMONPLACE_FORK_FROM via clap env attribute. May need COMMONPLACE_MQTT if direct MQTT support added to sync.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-30T06:44:05.946481773Z","updated_at":"2025-12-30T18:42:26.376893745Z","closed_at":"2025-12-30T18:42:26.376893745Z","created_by":"jes"}
{"id":"CP-lzy","title":"Sync sandbox exposes commonplace CLI tools to child","description":"Sync sandbox should ensure commonplace command line tools are available to the child process (in PATH or similar).","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-30T17:50:47.47569485Z","updated_at":"2025-12-30T22:09:01.350202303Z","closed_at":"2025-12-30T22:09:01.350202303Z","created_by":"jes","dependencies":[{"issue_id":"CP-lzy","depends_on_id":"CP-q3m","type":"blocks","created_at":"2025-12-30T18:02:57.44355175Z","created_by":"daemon"},{"issue_id":"CP-lzy","depends_on_id":"CP-8ci","type":"blocks","created_at":"2025-12-30T17:50:58.721422649Z","created_by":"daemon"}]}
{"id":"CP-zjl","title":"Sync tool wrapper mode: run executable in synced directory context","description":"Add a mode to invoke the sync tool that:\n\n1. Starts commonplace-sync to check out a directory tree to a local path\n2. Launches a specified executable in that synced directory context\n3. Keeps sync running while the executable is active\n4. When the child executable exits, the sync tool also exits and cleans up\n\nExample usage:\n```\ncommonplace-sync --exec \"vim .\" --server http://localhost:3000 --prefix notes --local ./workspace\n```\n\nThis enables workflows where a user wants to work on synced files with their preferred editor/tool, and have everything tear down cleanly when they're done.\n\n**Orchestrator compatibility:**\nThe sync tool should respect environment variable conventions of orchestrator-launched processes:\n- Pass through relevant env vars to the child process (e.g., `$EDITOR`, `$SHELL`, `$TERM`)\n- Respect standard orchestrator signals (SIGTERM, SIGINT) for graceful shutdown\n- Propagate child exit codes to the parent\n- Honor env-based configuration (e.g., `COMMONPLACE_SERVER`, `COMMONPLACE_PREFIX`)\n- Support `--` separator for passing args to the child executable","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-30T00:13:55.940464-08:00","updated_at":"2025-12-30T08:40:24.04936003Z","closed_at":"2025-12-30T08:40:24.04936003Z"}
{"id":"CP-bnv","title":"Add path-based HTTP API endpoints","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-29T08:33:32.251084948Z","updated_at":"2025-12-29T21:44:24.931689601Z","closed_at":"2025-12-29T21:44:24.931689601Z","created_by":"jes"}
{"id":"CP-5p5","title":"Investigate B-\u003eA sync not working: file watcher or echo detection issue","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-29T08:18:50.200861401Z","updated_at":"2025-12-29T16:02:38.701416395Z","closed_at":"2025-12-29T16:02:38.701416395Z","created_by":"jes"}
{"id":"CP-r2a","title":"Fix sync race condition: upload_task sends stale content during B-\u003eA sync","description":"When a server edit arrives via SSE, the handle_server_edit function fetches HEAD and writes to the local file. However, the file watcher can trigger upload_task with stale file content before the write completes, causing the old content to be synced back to the server.\n\nRoot cause: Echo detection relies on comparing file content to last_written_content, but there's a window between SSE notification and file write where upload_task can read stale content.\n\nPossible fixes:\n1. Add a flag to pause upload_task during server writes\n2. Use file modification timestamp comparison\n3. Add sequence numbers to track edit origin","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-29T16:02:47.797530633Z","updated_at":"2025-12-29T20:50:11.443695514Z","closed_at":"2025-12-29T20:50:11.443695514Z","created_by":"jes"}
{"id":"CP-oi3","title":"JSONL file support","description":"Internally stored as a Yjs array of maps, but sync tool should check it out as JSONL format (one JSON object per line).","notes":"Needs design: How should JSONL ↔ Yjs array/map conversion work? Need to define CRDT structure for array of maps and bidirectional conversion logic.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-30T17:46:27.750869028Z","updated_at":"2025-12-30T20:49:43.561621338Z","closed_at":"2025-12-30T20:49:43.561621338Z","created_by":"jes"}
{"id":"CP-jpx","title":"Sync client fails when files have pre-set node_ids but reconciler not running","description":"When .commonplace.json has pre-set node_ids (for file linking), sync correctly reads them but then waits forever for a reconciler to create the documents. The sync should either:\n1. Create documents directly via POST /docs if they don't exist\n2. Or clearly require --fs-root on the server\n\nCurrently blocks bartleby-telegram file linking use case.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-31T23:55:18.052642482Z","updated_at":"2026-01-01T00:04:03.65171956Z","closed_at":"2026-01-01T00:04:03.65171956Z","created_by":"jes"}
{"id":"CP-4f7","title":"Deprecate derived IDs - all files and directories should have UUIDs","description":"Derived IDs (like fs-root:path) are fragile - they break on rename. Every file and directory entry should have an explicit UUID node_id instead.\n\nThis affects:\n- Reconciler: should generate UUIDs for entries without node_id\n- Sync tool: should ensure all entries have UUIDs when scanning\n- Link tool: already does this for source files\n- Schema migration: existing derived IDs should be converted to UUIDs\n\nBenefits:\n- Stable references across renames\n- Links don't break when source is renamed\n- Simpler path resolution (just lookup by UUID)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T22:48:39.651047828Z","updated_at":"2025-12-30T23:12:28.538534864Z","closed_at":"2025-12-30T23:12:28.538534864Z","created_by":"jes"}
{"id":"CP-m2g","title":"Convert sync client to use path-based API","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-29T08:35:40.683147536Z","updated_at":"2025-12-29T22:21:03.49437558Z","closed_at":"2025-12-29T22:21:03.49437558Z","created_by":"jes","dependencies":[{"issue_id":"CP-m2g","depends_on_id":"CP-bnv","type":"blocks","created_at":"2025-12-29T08:35:57.462826032Z","created_by":"daemon"},{"issue_id":"CP-m2g","depends_on_id":"CP-pta","type":"blocks","created_at":"2025-12-29T08:37:30.460677237Z","created_by":"daemon"}]}
